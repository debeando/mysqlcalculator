<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MySQL Calculator</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </head>
  <body>
    <form class="form-horizontal" role="form" id="calculator">
    <div class="container bs-docs-container">
      <div class="row">
        <div class="col-md-8">
          <h1>MySQL Calculator</h1>
        </div>
        <div class="col-md-4" style="padding-top: 32px;">
          <a href="https://github.com/nicola51980/mysqlcalculator/issues/new">Report bug and new feature</a>
        </div>
      </div>
      <div class="row">
          <div class="col-md-9">
            <h2>Hardware</h2>
            <table class="table" style="width: 300px;">
              <thead>
                <tr>
                  <th>Variables</th>
                  <th>Value</th>
                  <th>Unit</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>RAM</td>
                  <td>
                    <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="hardware_ram_value" value="4">
                  </td>
                  <td>
                    <select style="width: 55px;" class="form-control input-sm" id="hardware_ram_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>CPU</td>
                  <td>
                    <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="hardware_cpu_value" value="1">
                  </td>
                  <td>&nbsp;</td>
                </tr>
                <tr>
                  <td>Disks</td>
                  <td>
                    <input style="width: 50px;" maxlength="2" class="form-control input-sm" id="hardware_disks_value" value="1">
                  </td>
                  <td>&nbsp;</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row">
          <div class="col-md-8">
            <h2>MySQL</h2>
            <table class="table">
              <thead>
                <tr>
                  <th>Variables</th>
                  <th>Percentage</th>
                  <th>Bytes</th>
                  <th>Value</th>
                  <th>Unit</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>innodb_buffer_pool_size</td>
                  <td>
                    <div id="innodb_bpz_percentage_group">
                      <input style="width: 50px;" class="form-control input-sm" id="innodb_bpz_percentage" disabled>
                    </div>
                  </td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="innodb_bpz_bytes" disabled>
                  </td>
                  <td>
                    <div id="innodb_bpz_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="innodb_bpz_value" value="3">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="innodb_bpz_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>innodb_additional_mem_pool_size</td>
                  <td>
                    <div id="innodb_amps_percentage_group">
                      <input style="width: 50px;" class="form-control input-sm" id="innodb_amps_percentage" disabled>
                    </div>
                  </td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="innodb_amps_bytes" disabled>
                  </td>
                  <td>
                    <div id="innodb_amps_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="innodb_amps_value" value="128">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="innodb_amps_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>innodb_log_file_size</td>
                  <td>
                    <div id="innodb_lfs_percentage_group">
                      <input style="width: 50px;" class="form-control input-sm" id="innodb_lfs_percentage" disabled>
                    </div>
                  </td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="innodb_lfs_bytes" disabled>
                  </td>
                  <td>
                    <div id="innodb_lfs_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="innodb_lfs_value" value="128">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="innodb_lfs_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>innodb_log_buffer_size</td>
                  <td>
                    <div id="innodb_lbs_percentage_group">
                      <input style="width: 50px;" class="form-control input-sm" id="innodb_lbs_percentage" disabled>
                    </div>
                  </td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="innodb_lbs_bytes" disabled>
                  </td>
                  <td>
                    <div id="innodb_lbs_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="innodb_lbs_value" value="32">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="innodb_lbs_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>key_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="key_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="key_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="key_buffer_size_value" value="8">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="key_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>net_buffer_length</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="net_buffer_length_bytes" disabled>
                  </td>
                  <td>
                    <div id="net_buffer_length_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="net_buffer_length_value" value="16">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="net_buffer_length_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                      <option value="1" selected="selected">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>query_cache_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="query_cache_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="query_cache_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="query_cache_size_value" value="256">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="query_cache_size_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>sort_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="sort_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="sort_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="sort_buffer_size_value" value="256">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="sort_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                      <option value="1" selected="selected">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>myisam_sort_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="myisam_sort_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="myisam_sort_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="myisam_sort_buffer_size_value" value="2">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="myisam_sort_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                      <option value="1">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>thread_stack</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="thread_stack_bytes" disabled>
                  </td>
                  <td>
                    <div id="thread_stack_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="thread_stack_value" value="256">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="thread_stack_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                      <option value="1" selected="selected">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>read_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="read_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="read_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="read_buffer_size_value" value="256">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="read_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                      <option value="1" selected="selected">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>read_rnd_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="read_rnd_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="read_rnd_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="read_rnd_buffer_size_value" value="2">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="read_rnd_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2" selected="selected">MB</option>
                      <option value="1">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>join_buffer_size</td>
                  <td>&nbsp;</td>
                  <td>
                    <input style="width: 120px;" class="form-control input-sm" id="join_buffer_size_bytes" disabled>
                  </td>
                  <td>
                    <div id="join_buffer_size_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="join_buffer_size_value" value="512">
                    </div>
                  </td>
                  <td>
                    <select style="width: 50px;" class="form-control input-sm" id="join_buffer_size_unit">
                      <option value="3">GB</option>
                      <option value="2">MB</option>
                      <option value="1" selected="selected">KB</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>max_connections</td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>
                    <div id="max_connections_value_group">
                      <input style="width: 50px;" maxlength="4" class="form-control input-sm" id="max_connections_value" value="128" disabled>
                    </div>
                  </td>
                  <td>&nbsp;</td>
                </tr>
                <tr>
                  <td>innodb_thread_concurrency</td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>
                    <div id="innodb_thread_concurrency_value_group">
                      <input style="width: 50px;" maxlength="3" class="form-control input-sm" id="innodb_thread_concurrency_value" value="6" disabled>
                    </div>
                  </td>
                  <td>&nbsp;</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="col-md-4">

          </div>
      </div>
    </div>
    </form>
  </body>
  <script type="text/javascript">
$(document).ready(function() {
  calculate();

  $("input[id$='_value']").keypress(function(event) {
    // Backspace, tab, enter, end, home, left, right
    // We don't support the del key in Opera because del == . == 46.
    var controlKeys = [8, 9, 13, 35, 36, 37, 39];
    // IE doesn't support indexOf
    var isControlKey = controlKeys.join(",").match(new RegExp(event.which));
    // Some browsers just don't raise events for control keys. Easy.
    // e.g. Safari backspace.
    if (!event.which || // Control keys in most browsers. e.g. Firefox tab is 0
        (49 <= event.which && event.which <= 57) || // Always 1 through 9
        (48 == event.which && $(this).attr("value") || // No 0 first digit
        (46 == event.which)) || // Allow dot (.)
        isControlKey) { // Opera assigns values for control keys.
      return;
    } else {
      event.preventDefault();
    }
  });

  $("input[id$='_value']").each(function() {
    to_bytes(this.id);
  });

  $("input[id$='_value'],select[id$='_unit']").on('change',function() {
    to_bytes(this.id);
    calculate();
  });
});

function calculate() {
  innodb_bpz();
  innodb_frist('amps', 1, 5);
  innodb_frist('lfs',  1, 20);
  innodb_frist('lbs',  1, 2);
  get_max_connections();
  get_innodb_thread_concurrency();
}

function get_value(name) {
  var value = $('#' + name + '_value').val();
  var unit  = $('#' + name + '_unit').val();
  return value * Math.pow(1024, unit);
}

function get_percentage(x,y) {
  return ((x/y)*100).toFixed(0);
}

function to_bytes(id) {
  var name = id.replace('_value', '').replace('_unit', '');
  var value = get_value(name);
  $('#' + name + '_bytes').val(value);
}

function valid_value(value) {
  return (( value % 1024 ) == 0 )? true : false;
}

function innodb_frist(name, min, max) {
  ram        = $('#innodb_bpz_bytes').val();
  value      = get_value('innodb_' + name);
  percentage = get_percentage(value, ram);

  if(percentage >= min && percentage <= max) {
    $('#innodb_' + name + '_value_group').removeClass('has-error');
  } else {
    $('#innodb_' + name + '_value_group').addClass('has-error');
  }

  $('#innodb_' + name + '_percentage').val(percentage);
  $('#innodb_' + name + '_bytes').val(value);
}

function innodb_bpz() {
  ram        = get_value('hardware_ram');
  bpz        = get_value('innodb_bpz');
  percentage = get_percentage(bpz, ram);

  if(bpz <= ram &&
     (percentage >= 50 && percentage <= 80)) {
    $('#innodb_bpz_value_group').removeClass('has-error');
  } else {
    $('#innodb_bpz_value_group').addClass('has-error');
  }

  $('#innodb_bpz_percentage').val(percentage);
  $('#innodb_bpz_bytes').val(bpz);
}

function get_max_connections() {
  ram = get_value('hardware_ram');

  global_buffers  = get_value('key_buffer_size');
  global_buffers += get_value('innodb_bpz');
  global_buffers += get_value('innodb_lbs');
  global_buffers += get_value('innodb_amps');
  global_buffers += get_value('net_buffer_length');
  global_buffers += get_value('query_cache_size');

  thread_buffers  = get_value('sort_buffer_size');
  thread_buffers += get_value('myisam_sort_buffer_size');
  thread_buffers += get_value('thread_stack');
  thread_buffers += get_value('read_buffer_size');
  thread_buffers += get_value('join_buffer_size');
  thread_buffers += get_value('read_rnd_buffer_size');

  $('#max_connections_value').val(Math.round((ram - global_buffers)/thread_buffers));
}

function get_innodb_thread_concurrency() {
  var cpu   = $('#hardware_cpu_value').val();
  var core  = $('#hardware_core_value').val();
  var disks = $('#hardware_disks_value').val();

  $('#innodb_thread_concurrency_value').val(2 * (parseInt(cpu) + parseInt(disks)));
}

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-17220206-2']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

  </script>
</html>